# 🗑️ 垃圾分类小能手

一个用 Python + Pygame 做的**垃圾分类小游戏**，帮助小朋友学习垃圾分类知识！

---

## 🎮 游戏怎么玩？

1. 打开游戏后，点击「开始游戏」
2. 屏幕中间会出现一个**垃圾物品**（比如 🍌 果皮、🔋 电池）
3. 用鼠标**按住它，拖到下面正确的垃圾桶**里
4. 每个垃圾只有 **10 秒**时间，要快！
5. 分对了 **+2 分**，分错了 **-1 分**，超时也 **-1 分**
6. 一共 **50 个垃圾**，全部分完后看你的成绩！

### 四种垃圾桶

| 颜色 | 类型 | 例子 |
|------|------|------|
| 🔵 蓝色 | 可回收 | 纸盒📦、塑料瓶🧴、旧报纸📰 |
| 🟢 绿色 | 厨余 | 果皮🍌、鱼骨🐟、面包🍞 |
| 🔴 红色 | 有害 | 电池🔋、过期药💊、灯管💡 |
| 🟡 黄色 | 其他 | 纸巾🧻、口罩😷、烟蒂🚬 |

---

## 💻 怎么运行这个游戏？

### 第 1 步：安装 Python

去 [python.org](https://www.python.org/downloads/) 下载安装 Python（版本 3.8 以上都可以）。

### 第 2 步：安装需要的库

打开终端（Mac 叫"终端"，Windows 叫"命令提示符"），输入：

```bash
pip install pygame Pillow
```

- **pygame**：用来做游戏窗口、画图、响应鼠标操作
- **Pillow**：用来把 emoji 表情渲染成游戏里的图片

### 第 3 步：运行游戏

```bash
python main.py
```

---

## 📖 代码结构讲解（给小学生看的版本）

整个游戏只有一个文件 `main.py`，大约 500 行。下面一块一块地讲：

### 1️⃣ 导入工具（第 8-18 行）

```python
import pygame      # 游戏引擎，帮我们画窗口、图形、处理鼠标
import random       # 随机打乱垃圾的出场顺序
import math         # 数学计算（画星星用到）
from PIL import Image, ImageFont  # 把 emoji 变成图片
```

就像做手工前先准备工具一样，写代码前要先"导入"需要用到的工具包。

### 2️⃣ 常量配置（第 22-53 行）

```python
SCREEN_W, SCREEN_H = 1440, 900   # 窗口宽 1440 像素，高 900 像素
FPS = 60                          # 每秒画 60 帧（动画流畅）
TIME_LIMIT = 10                   # 每个垃圾限时 10 秒
```

**常量**就是"不会变的数字"，把它们写在最前面，以后想改（比如把 10 秒改成 15 秒）只需要改一个地方。

颜色用 **(红, 绿, 蓝)** 三个数字表示，每个 0~255：
- `(255, 255, 255)` = 白色
- `(255, 0, 0)` = 红色
- `(0, 0, 0)` = 黑色

### 3️⃣ 垃圾数据表（第 55-70 行）

```python
TRASH_ITEMS = [
    ("纸盒", CAT_RECY, "📦"),
    ("果皮", CAT_KITCHEN, "🍌"),
    ("电池", CAT_HAZ, "🔋"),
    ...  # 一共 50 个
]
```

每个垃圾是一个**元组**（tuple），包含三样东西：
- **名字**：显示在屏幕上的文字
- **类别**：它属于哪种垃圾（可回收/厨余/有害/其他）
- **emoji**：它长什么样子

### 4️⃣ 工具函数（第 72-131 行）

这些是可以反复使用的"小帮手"函数：

| 函数名 | 干什么的 | 生活比喻 |
|--------|---------|---------|
| `get_font(size)` | 加载中文字体 | 选一支笔 |
| `draw_text(...)` | 在屏幕上写字 | 用笔写字 |
| `draw_gradient(...)` | 画渐变背景 | 从蓝色慢慢变成橙色的天空 |
| `rounded_rect(...)` | 画圆角矩形 | 画一个圆角卡片 |
| `draw_button(...)` | 画按钮 | 画一个可以点的按钮 |
| `draw_star(...)` | 画五角星 | 装饰用的小星星 |

### 5️⃣ Emoji 渲染（第 133-224 行）

这部分比较特别——**pygame 自己不能显示彩色 emoji**！所以我们用了一个聪明的办法：

1. 用 **Pillow（PIL）** 这个图片库，调用系统的 emoji 字体，把 emoji 画到一张透明图片上
2. 再把这张图片转换成 pygame 能用的格式
3. 用**缓存**（`_emoji_cache`）存起来，下次用同一个 emoji 不用重新画

```
emoji 字符 "🍌"
    → Pillow 渲染成图片
    → 转换为 pygame Surface
    → 显示在游戏窗口里
```

> ⚠️ Apple 的 emoji 字体只支持特定大小（20、32、64、96、160 等），所以代码里会自动选一个合适的大小来渲染，再缩放到需要的尺寸。

### 6️⃣ TrashItem 类（第 245-278 行）

```python
class TrashItem:
    def __init__(self, name, category, index, emoji):
        self.name = name          # 名字
        self.category = category  # 正确类别
        self.emoji = emoji        # emoji 图标
        self.pos = [720, 260]     # 在屏幕上的位置
        self.dragging = False     # 是否正在被拖动
```

**类（class）** 就像一个"模板"。`TrashItem` 是"垃圾物品"的模板，每个垃圾都有自己的名字、类别、位置，还能被鼠标拖动。

它有这些"技能"（方法）：
- `start_drag()`：鼠标按下时，开始拖动
- `drag()`：鼠标移动时，跟着鼠标走
- `stop_drag()`：鼠标松开时，停止拖动
- `draw()`：把自己画在屏幕上

### 7️⃣ Game 类 — 游戏核心（第 285-496 行）

这是整个游戏的"大脑"，控制所有逻辑。

#### 游戏有 4 个状态（就像 4 个房间）：

```
┌──────────┐    点击开始    ┌──────────┐
│  菜单页  │ ──────────→  │  游戏中  │
│  (menu)  │ ←──────────  │  (play)  │
└──────────┘    按 ESC     └──────────┘
     ↕ 点击帮助/返回              │ 50个垃圾分完
┌──────────┐               ┌──────────┐
│  帮助页  │               │  结果页  │
│  (help)  │               │ (result) │
└──────────┘               └──────────┘
```

#### 核心方法：

| 方法 | 作用 |
|------|------|
| `reset_game()` | 重新开始：打乱 50 个垃圾，分数归零 |
| `current_item()` | 获取当前要分类的垃圾 |
| `handle_drop()` | 判断垃圾放到了哪个桶，对不对 |
| `update_game()` | 每帧更新：处理鼠标事件、检查是否超时 |
| `time_left()` | 计算剩余时间 |
| `draw_xxx()` | 各种画画函数，把当前状态画到屏幕上 |

#### 游戏主循环 `run()`（第 444 行）：

```python
while True:              # 一直循环，直到关闭窗口
    处理事件（鼠标点击、键盘按键、关闭窗口）
    根据当前状态，画对应的页面
    pygame.display.flip() # 把画好的内容显示出来
    clock.tick(60)        # 控制每秒 60 帧
```

这就像**翻页动画**——每秒画 60 张图，人眼看起来就是流畅的动画！

---

## 🧠 学到的编程知识

通过这个游戏，你可以学到：

| 知识点 | 在代码里怎么用的 |
|--------|----------------|
| **变量** | `score = 0`（记录分数） |
| **列表（list）** | `TRASH_ITEMS = [...]`（存 50 个垃圾） |
| **元组（tuple）** | `("纸盒", "可回收", "📦")`（一组数据打包在一起） |
| **字典（dict）** | `CATEGORY_STYLES = {...}`（类别对应颜色） |
| **函数（function）** | `def draw_text(...)`（可以重复使用的代码块） |
| **类（class）** | `class TrashItem`（给垃圾创建一个模板） |
| **条件判断（if）** | `if b["cat"] == item.category`（判断分类对不对） |
| **循环（for/while）** | `for b in self.bins`（遍历每个垃圾桶） |
| **异常处理（try）** | `try: ... except: ...`（出错了不让程序崩溃） |

---

## 📁 文件说明

```
ghx/
├── main.py        ← 游戏代码（就这一个文件！）
└── README.md      ← 你正在看的这个说明文件
```

---

## ❓ 常见问题

**Q：运行报错 `No module named 'pygame'`？**
A：忘装了！运行 `pip install pygame Pillow`

**Q：emoji 显示成灰色方块？**
A：Pillow 版本太老。运行 `pip install --upgrade Pillow`

**Q：窗口太大/太小？**
A：修改第 23 行的 `SCREEN_W, SCREEN_H = 1440, 900`，改成你喜欢的大小

**Q：想增加新的垃圾？**
A：在 `TRASH_ITEMS` 列表里加一行，格式：`("名字", 类别, "emoji")`

---

## 📦 打包成 Windows exe（不需要安装 Python）

本项目配置了 GitHub Actions，推送代码后可以自动在云端打包生成 Windows 可执行文件。

### 使用方法

#### 方式一：手动触发

1. 把代码推到 GitHub
2. 进入仓库页面 → **Actions** 标签页
3. 左侧选择「打包 Windows exe」
4. 点击右侧 **Run workflow** 按钮
5. 等待几分钟，完成后在该次运行页面下方的 **Artifacts** 区域下载 `垃圾分类小能手-windows.zip`

#### 方式二：打 tag 自动触发并发布 Release

```bash
git tag v1.0
git push origin v1.0
```

打包完成后，exe 会自动出现在仓库的 **Releases** 页面，可以直接分享下载链接。
